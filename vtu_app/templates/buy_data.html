<!DOCTYPE html>
<html lang="en">
<head>
{% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Data</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const networkSelect = document.getElementById('networkid');
        const dataGroupSelect = document.getElementById('datagroup');
        const dataPlanSelect = document.getElementById('dataplan');
        const amountInput = document.getElementById('amounttopay');

        function fetchDataPlans() {
            const networkId = networkSelect.value;
            const dataType = dataGroupSelect.value;

            if (networkId && dataType) {
                fetch(`/get_data_plans/?network_id=${networkId}&data_type=${dataType}`)
                    .then(response => response.json())
                    .then(data => {
                        dataPlanSelect.innerHTML = '<option value="">Select Plan</option>';
                        if (data.plans) {
                            data.plans.forEach(plan => {
                                dataPlanSelect.innerHTML += `<option value="${plan.pId}" data-price="${plan.userprice}">${plan.name} ${plan.atype} = &#8358;${plan.userprice} (${plan.atype}) ${plan.day}days </option>`;
                            });
                        }
                    });
            }
        }

        networkSelect.addEventListener('change', fetchDataPlans);
        dataGroupSelect.addEventListener('change', fetchDataPlans);

        dataPlanSelect.addEventListener('change', (e) => {
            const selectedOption = e.target.selectedOptions[0];
            amountInput.value = selectedOption.getAttribute('data-price') || '';
        });
    });
</script>

</head>
<body>
    <div class="container py-5">
        <div class="card shadow-sm">
            <div class="card-header text-center bg-primary text-white">
                <h2>Buy Data</h2>
                <p class="mb-0">Data For All Networks</p>
            </div>
            <div class="card-body">
                <div class="text-center mb-4">
                    <div class="d-flex justify-content-around">
                        <a href="javascript:selectNetworkByIcon('MTN');">
                            <img src="{% static 'images/icons/mtn.png' %}" alt="MTN" width="50" />
                        </a>
                        <a href="javascript:selectNetworkByIcon('AIRTEL');">
                            <img src="{% static 'images/icons/airtel.png' %}" alt="Airtel" width="50" />
                        </a>
                        <a href="javascript:selectNetworkByIcon('GLO');">
                            <img src="{% static 'images/icons/glo.png' %}" alt="Glo" width="50" />
                        </a>
                        <a href="javascript:selectNetworkByIcon('9MOBILE');">
                            <img src="{% static 'images/icons/9mobile.png' %}" alt="9Mobile" width="50" />
                        </a>
                    </div>
                </div>{% load static %}

                <marquee class="bg-light py-2 mb-3 border rounded">
                    [MTN SME] - *323# - [MTN Gifting] - *323# - [9Mobile] - *323# - [Airtel] - *323# - [Glo] - *323#
                </marquee>

                <form method="post" id="dataplanForm" action="{% url 'buy_data' %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="networkid" class="form-label">Network</label>
                        <select id="networkid" name="network" class="form-select">
                            <option value="" disabled selected>Select Network</option>
                            {% for network in data %}
                                {% if network.networkStatus == "On" %}
                                    <option value="{{ network.nId }}">{{ network.network }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="datagroup" class="form-label">Data Type</label>
                        <select id="datagroup" name="datagroup" class="form-select">
                            <option value="">Select Type</option>
                            <option value="SME">SME</option>
                            <option value="Gifting">Gifting</option>
                            <option value="Corporate">Corporate</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="dataplan" class="form-label">Data Plan</label>
                        <select id="dataplan" name="dataplan" class="form-select" required></select>
                    </div>

                    <div class="mb-3">
                        <label for="phone" class="form-label">Phone Number</label>
                        <input type="number" class="form-control" id="phone" name="phone" placeholder="Phone Number" required />
                    </div>

                    <div class="mb-3">
                        <label for="amounttopay" class="form-label">Amount To Pay</label>
                        <input type="text" class="form-control" id="amounttopay" name="amounttopay" placeholder="Amount To Pay" readonly required />
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="ported_number" name="ported_number">
                        <label class="form-check-label" for="ported_number">
                            Disable Number Validator
                        </label>
                    </div>

                    <input name="transref" type="hidden" value="{{ transRef }}" />
                    <input name="transkey" id="transkey" type="hidden" />

                    <button type="submit" class="btn btn-primary w-100">Buy Data</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
